// = Your Blog title
// See https://hubpress.gitbooks.io/hubpress-knowledgebase/content/ for information about the parameters.
// :hp-image: /covers/cover.png
// :published_at: 2019-01-31
// :hp-tags: HubPress, Blog, Open_Source,
// :hp-alt-title: My English Title

= Proxmox VE: Virtualization for Work and Play (Getting Started)
:hp-alt-title: Server Virtualization Management Part2
:hp-tags: Blog, Open_Source, Technology
:icons: image
:toc: macro
:toclevels: 3
:published_at: 2017-04-25

In the link:/2017/04/23/Server-Virtualization-Management[previous post] we learned about ProxMox and outlined our plan to build a powerful "bang for the buck" home server for games _and_ other system-intensive pursuits. Now we begin.

toc::[]

== Installation

https://forum.level1techs.com/t/proxmox-zfs-with-ssd-caching-setup-guide/97663
https://pve.proxmox.com/wiki/Quick_installation

Disconnect all the drives except the boot drive

KVM

== Post-Install

=== GPU Passthrough

GPU Passthrough allows our VM to access GPU hardware for graphics and for computation (i.e. deep learning). To enable, we must update our settings for IOMMU support icluding interrupt remapping, and include additional Linux modules.

Update boot settings:

. Type: `vi /etc/default/grub`
.. Enter edit mode: `i`
.. Change: `GRUB_CMDLINE_LINUX_DEFAULT="quiet"`
.. To: `GRUB_CMDLINE_LINUX_DEFAULT="quiet amd_iommu=on"`
.. Exit edit mode: <esc>
. Save and exit: `wq <enter>`
. Run: `update-grub`

Update modules settings:

. Type: `vi /etc/modules`
.. Enter edit mode: `i`
.. Add: `vfio`
.. Add: `vfio_iommu_type1`
.. Add: `vfio_pci`
.. Add: `vfio_virqfd`
.. Exit edit mode: <esc>
. Save and exit: `wq <enter>`
. Type: `echo "options vfio_iommu_type1 allow_unsafe_interrupts=1" > /etc/modprobe.d/iommu_unsafe_interrupts.conf`

Identify the GPU to passthrough:

. Identify all GPUs: `lspci | grep VGA`
. Capture the GPU IDs: `lspci | grep VGA | cut -d "." -f1`
.. My GPU ID for passthrough is: `28:00`
.. My GPU ID for the host is: `21:00`
. Identify the vendor IDs for the passthrough GPU: `lspci -ns 28:00`
.. The vendor ID for my GPU VGA device: `10de:1b80`
.. The vendor ID for my GPU Audio device: `10de:10f0`
. Update module settings;
.. Connect both of your IDs into a comma separate list like `10de:1b80,10de:10f0` and update the "ids" parameter in the following command.
.. Type: `echo "options vfio-pci ids=*10de:1b80,10de:10f0*" > /etc/modprobe.d/vfio.conf`

//echo "blacklist nvidia" >> /etc/modprobe.d/blacklist.conf 
// https://pve.proxmox.com/wiki/Pci_passthrough 

// lspci -nn | grep `lspci | grep VGA | cut -d "." -f1` 

=== Emulation Settings

In the file: /etc/pve/qemu-server/101.conf

* Update the following: `cpu: Haswell,hidden=1`
* Add the following: `args: ...`


=== Security

https://www.kiloroot.com/secure-proxmox-install-sudo-firewall-with-ipv6-and-more-how-to-configure-from-start-to-finish/


=== Optimization


Remove Proxmox License Nag: sed -i.bak "s/data.status !== 'Active'/false/g" /usr/share/pve-manager/ext6/pvemanagerlib.js

For good performance, we need to configure SPICE (Simple Protocol for Independent Computing Environments). The SPICE packages include drivers (QXL and virtio) that enhance virtualization performance:

* SPICE Client (virt-viewer) for Linux, Windows, and Mac systems
* SPICE Guest Tools for the virtual machines

https://pve.proxmox.com/wiki/Paravirtualized_Block_Drivers_for_Windows

https://pve.proxmox.com/wiki/Windows_7_guest_best_practices

https://pve.proxmox.com/wiki/SPICE

https://www.spice-space.org/download.html



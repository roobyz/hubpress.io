// = Your Blog title
// See https://hubpress.gitbooks.io/hubpress-knowledgebase/content/ for information about the parameters.
// :hp-image: /covers/cover.png
// :published_at: 2019-01-31
// :hp-tags: HubPress, Blog, Open_Source,
// :hp-alt-title: My English Title

= Proxmox VE: Virtualization for Work and Play
:hp-alt-title: Server Virtualization Management
:hp-tags: Blog, Open_Source, Technology
:icons: image

Say we want a powerful "bang for the buck" home server for games _and_ other system-intensive pursuits. We may want to run powerful analytics applications which undoubtably requires Linux, but we may also want to run Windows applications. Finally, we want near native 2D and 3D graphics performance inside the guest operating system (OS) while making dual-booting obsolete. 

With the help of link:https://www.proxmox.com/en/[Proxmox Virtual Environment (PVE)] we can achieve these goals. PVE enables the creation of multiple virtual OS "servers" via a Web GUI; as many as our hardware allows. This guide will document the Proxmox setup on the following hardware:

* AMD Ryzen 7 1600 (8 cores, 16 threads @ 3.7GHz)
* 64GB 2400MHz DDR4
* Boot Drive: 1x 512GB Samsung 950-PRO NVMe V-Nand SSD 
* Storage (Striped-mirrored ZFS):
** 2x 1TB Mushkin SSD
** 1x 2TB 7200rpm mechanical drives


== Hardware Considerations

Our CPU and motherboard must support "virtualization” (SVM) and IOMMU, which must be enabled in firmware for proper resource sharing. We need 32GB of RAM or more, so that we can reserve at least 16GB for a single virtual machine (VM) and still have enough memory left over for ProxMox and other VMs.

While most of the computer hardware can be shared between multiple operating systems (OS), the graphics card (GPU) cannot readily be shared. We'll need at least two GPUs:

. One GPU for ProxMox (the host);
. One powerful GPU for our VM (the guest: Windows, Linux, etc.).

== Software


Disconnect all the drives except the boot drive

https://jannikjung.me/proxmox-ve-5-0-beta1/

KVM

Debian Linux

== Installation

https://pve.proxmox.com/wiki/Quick_installation


== Post-Install

=== Security

https://www.kiloroot.com/secure-proxmox-install-sudo-firewall-with-ipv6-and-more-how-to-configure-from-start-to-finish/


=== Optimization


Remove Proxmox License Nag: sed -i.bak "s/data.status !== 'Active'/false/g" /usr/share/pve-manager/ext6/pvemanagerlib.js

For good performance, we need to configure SPICE (Simple Protocol for Independent Computing Environments). The SPICE packages include drivers (QXL and virtio) that enhance virtualization performance:

* SPICE Client (virt-viewer) for Linux, Windows, and Mac systems
* SPICE Guest Tools for the virtual machines

https://pve.proxmox.com/wiki/Paravirtualized_Block_Drivers_for_Windows

https://pve.proxmox.com/wiki/Windows_7_guest_best_practices

https://pve.proxmox.com/wiki/SPICE

https://www.spice-space.org/download.html

=== Further Tweaks

==== Emulation Settings

In the file: /etc/pve/qemu-server/101.conf

* Update the following: `cpu: Haswell,hidden=1`
* Add the following: `args: ...`

==== GPU Passthrough

https://pve.proxmox.com/wiki/Pci_passthrough

Identify the video card: 
```
lspci -nn | grep `lspci | grep VGA | cut -d "." -f1` 
```

Take a note of the IDs in the square brackets near the end of each line: in my case 10de:1b80 (graphics) and 10de:10f0 (audio).

```
echo "options vfio-pci ids=10de:1b80,10de:10f0" > /etc/modprobe.d/vfio.conf
```

//Update the grub settings:

//* GRUB_CMDLINE_LINUX_DEFAULT="quiet splash" to:
//* GRUB_CMDLINE_LINUX_DEFAULT="quiet amd_iommu=on"

amd_iommu=on



// = Your Blog title
// See https://hubpress.gitbooks.io/hubpress-knowledgebase/content/ for information about the parameters.
// :hp-image: /covers/cover.png
// :published_at: 2019-01-31
// :hp-tags: HubPress, Blog, Open_Source,
// :hp-alt-title: My English Title

= Proxmox: Server Virtualization for Work and Play
:hp-alt-title: Server Virtualization Management
:hp-tags: Blog, Open_Source, Technology
:icons: image

Say we want to build a powerful server for the home office and we want good "bang for the buck". We want to run some powerful analytics software which undoubtably requires Linux, and we still want to run Windows. In addition, we want near native 2D and 3D graphics performance inside the guest OS while making dual-booting obsolete.

== Hardware

We'll need a CPU and motherboard that supports IOMMU to allow hardware virtualization. While most of the computer hardware can be shared between multiple operating systems (OS), the graphics card (GPU) cannot be shared. We'll need at least two graphics cards:

. One GPU for ProxMox (the host);
. One reasonably powerful GPU for your virtual machine (VM) guest (Windows or Linux).

We need to ensure that “VT-d” (Intel) or “AMD Virtualization” (AMD) is enabled in firmware. Since presumably we'll be using our VMs for games and other system-intensive pursuits, it’s a good idea to have 32GB of RAM or more, so that we can reserve at least 16GB for a single VM and still have some left over for ProxMox.

1600 Ryzen
NVMe
SSD
Disks

== Software

Proxmox is a relatively easy to install solution that fits the bill. It facilitates the creation and connection of virtual "servers" via a PVE Web GUI. We can create and connect to multiple virtual machines; as many as our hardware allows.

Disconnect all the drives except the boot drive

https://jannikjung.me/proxmox-ve-5-0-beta1/

KVM

Debian Linux

== Installation

https://pve.proxmox.com/wiki/Quick_installation


== Post-Install

=== Security

https://www.kiloroot.com/secure-proxmox-install-sudo-firewall-with-ipv6-and-more-how-to-configure-from-start-to-finish/


=== Optimization


Remove Proxmox License Nag: sed -i.bak "s/data.status !== 'Active'/false/g" /usr/share/pve-manager/ext6/pvemanagerlib.js

For good performance, we need to configure SPICE (Simple Protocol for Independent Computing Environments). The SPICE packages include drivers (QXL and virtio) that enhance virtualization performance:

* SPICE Client (virt-viewer) for Linux, Windows, and Mac systems
* SPICE Guest Tools for the virtual machines

https://pve.proxmox.com/wiki/Paravirtualized_Block_Drivers_for_Windows

https://pve.proxmox.com/wiki/Windows_7_guest_best_practices

https://pve.proxmox.com/wiki/SPICE

https://www.spice-space.org/download.html

=== Further Tweaks

==== Emulation Settings

In the file: /etc/pve/qemu-server/101.conf

* Update the following: `cpu: Haswell,hidden=1`
* Add the following: `args: ...`

==== GPU Passthrough

https://pve.proxmox.com/wiki/Pci_passthrough

Identify the video card: 
```
lspci -nn | grep `lspci | grep VGA | cut -d "." -f1` 
```

Take a note of the IDs in the square brackets near the end of each line: in my case 10de:1b80 (graphics) and 10de:10f0 (audio).

Edit: `/etc/modprobe.d/vfio.conf`
Add: `options vfio-pci ids=10de:1b80,10de:10f0`

//Update the grub settings:

//* GRUB_CMDLINE_LINUX_DEFAULT="quiet splash" to:
//* GRUB_CMDLINE_LINUX_DEFAULT="quiet splash amd_iommu=on pci-stub.ids=10de:1b80,10de:10f0"

amd_iommu=on


